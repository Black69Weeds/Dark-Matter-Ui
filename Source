--[[
    Eclipse UI Library (Luna/Eulen Hybrid)
    - Modern Dark Theme
    - Simple Config System (Flags table)
    - Proper Minimize vs Close logic
    - Dashboard Home Page
]]

local TweenService      = game:GetService("TweenService")
local UserInputService  = game:GetService("UserInputService")
local HttpService       = game:GetService("HttpService")
local Players           = game:GetService("Players")
local RunService        = game:GetService("RunService")
local MarketplaceService= game:GetService("MarketplaceService")

local LocalPlayer = Players.LocalPlayer

-- CoreGui may error in some contexts, so use pcall
local CoreGui
do
    local ok, cg = pcall(function()
        return game:GetService("CoreGui")
    end)
    CoreGui = ok and cg or nil
end

local Library = {
    Flags = {},
    Theme = {
        Accent     = Color3.fromRGB(114, 137, 218), -- default accent
        Background = Color3.fromRGB(10, 10, 10),
        Card       = Color3.fromRGB(18, 18, 18),
        Text       = Color3.fromRGB(240, 240, 240),
        TextDim    = Color3.fromRGB(150, 150, 150),
        Outline    = Color3.fromRGB(35, 35, 35),
    },
    Folder = "EclipseConfig"
}

---------------------------------------------------------------------
-- CONFIG HELPERS (safe on non-exploits)
---------------------------------------------------------------------
local function hasFileAPI()
    return writefile and readfile and isfile and isfolder and makefolder
end

function Library:SaveConfig(name)
    if not hasFileAPI() then
        warn("[Eclipse] File API not available (writefile/isfile). Skipping SaveConfig.")
        return
    end

    if not name or name == "" then
        warn("[Eclipse] SaveConfig called with empty name.")
        return
    end

    if not isfolder(self.Folder) then
        makefolder(self.Folder)
    end

    local ok, json = pcall(HttpService.JSONEncode, HttpService, self.Flags)
    if not ok then
        warn("[Eclipse] Failed to encode config:", json)
        return
    end

    local path = string.format("%s/%s.json", self.Folder, name)
    writefile(path, json)
    print("[Eclipse] Config saved to", path)
end

function Library:LoadConfig(name)
    if not hasFileAPI() then
        warn("[Eclipse] File API not available (readfile/isfile). Skipping LoadConfig.")
        return nil
    end

    if not name or name == "" then
        warn("[Eclipse] LoadConfig called with empty name.")
        return nil
    end

    if not isfolder(self.Folder) then
        return nil
    end

    local path = string.format("%s/%s.json", self.Folder, name)
    if not isfile(path) then
        return nil
    end

    local content = readfile(path)
    local ok, decoded = pcall(HttpService.JSONDecode, HttpService, content)
    if not ok then
        warn("[Eclipse] Failed to decode config:", decoded)
        return nil
    end

    for k, v in pairs(decoded) do
        self.Flags[k] = v
    end

    print("[Eclipse] Config loaded from", path)
    return decoded
end

---------------------------------------------------------------------
-- DRAGGABLE UTILITY
---------------------------------------------------------------------
local function MakeDraggable(trigger, object)
    local dragging, dragInput, dragStart, startPos

    trigger.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1
        or input.UserInputType == Enum.UserInputType.Touch then
            dragging  = true
            dragStart = input.Position
            startPos  = object.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    trigger.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement
        or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging and startPos and dragStart then
            local delta = input.Position - dragStart
            local newPos = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )

            TweenService:Create(object, TweenInfo.new(0.08), {
                Position = newPos
            }):Play()
        end
    end)
end

---------------------------------------------------------------------
-- MAIN WINDOW
---------------------------------------------------------------------
function Library:CreateWindow(config)
    config = config or {}

    local windowName = config.Name or "Eclipse UI"
    local accent     = config.Accent or self.Theme.Accent

    -- ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "EclipseHub"
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.ResetOnSpawn = false
    if CoreGui then
        screenGui.Parent = CoreGui
    else
        screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    end

    -- Main frame
    local main = Instance.new("Frame")
    main.Name = "Main"
    main.Parent = screenGui
    main.BackgroundColor3 = self.Theme.Background
    main.Position = UDim2.new(0.5, -325, 0.5, -210)
    main.Size = UDim2.new(0, 650, 0, 420)
    main.ClipsDescendants = true

    local mainCorner = Instance.new("UICorner")
    mainCorner.CornerRadius = UDim.new(0, 8)
    mainCorner.Parent = main

    local mainStroke = Instance.new("UIStroke")
    mainStroke.Parent = main
    mainStroke.Color = self.Theme.Outline
    mainStroke.Thickness = 1

    -- Sidebar
    local sidebar = Instance.new("Frame")
    sidebar.Parent = main
    sidebar.BackgroundColor3 = self.Theme.Card
    sidebar.Size = UDim2.new(0, 60, 1, 0)
    sidebar.ZIndex = 2

    local sideStroke = Instance.new("UIStroke")
    sideStroke.Parent = sidebar
    sideStroke.Color = self.Theme.Outline
    sideStroke.Thickness = 1

    local sideCorner = Instance.new("UICorner")
    sideCorner.CornerRadius = UDim.new(0, 8)
    sideCorner.Parent = sidebar

    local sideCover = Instance.new("Frame")
    sideCover.Parent = sidebar
    sideCover.BackgroundColor3 = self.Theme.Card
    sideCover.BorderSizePixel = 0
    sideCover.Position = UDim2.new(1, -5, 0, 0)
    sideCover.Size = UDim2.new(0, 5, 1, 0)
    sideCover.ZIndex = 2

    -- Sidebar tab container
    local tabContainer = Instance.new("ScrollingFrame")
    tabContainer.Parent = sidebar
    tabContainer.BackgroundTransparency = 1
    tabContainer.Position = UDim2.new(0, 0, 0, 50)
    tabContainer.Size = UDim2.new(1, 0, 1, -50)
    tabContainer.ScrollBarThickness = 0
    tabContainer.CanvasSize = UDim2.new(0, 0, 0, 0)

    local tabList = Instance.new("UIListLayout")
    tabList.Parent = tabContainer
    tabList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabList.Padding = UDim.new(0, 10)
    tabList.SortOrder = Enum.SortOrder.LayoutOrder

    tabList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        tabContainer.CanvasSize = UDim2.new(0, 0, 0, tabList.AbsoluteContentSize.Y + 20)
    end)

    -- Top bar
    local topBar = Instance.new("Frame")
    topBar.Parent = main
    topBar.BackgroundTransparency = 1
    topBar.Position = UDim2.new(0, 60, 0, 0)
    topBar.Size = UDim2.new(1, -60, 0, 40)

    local titleLbl = Instance.new("TextLabel")
    titleLbl.Parent = topBar
    titleLbl.BackgroundTransparency = 1
    titleLbl.Position = UDim2.new(0, 15, 0, 0)
    titleLbl.Size = UDim2.new(0, 200, 1, 0)
    titleLbl.Font = Enum.Font.GothamBold
    titleLbl.Text = windowName
    titleLbl.TextColor3 = self.Theme.Text
    titleLbl.TextSize = 14
    titleLbl.TextXAlignment = Enum.TextXAlignment.Left

    -- Control buttons
    local controlHolder = Instance.new("Frame")
    controlHolder.Parent = topBar
    controlHolder.BackgroundTransparency = 1
    controlHolder.Position = UDim2.new(1, -80, 0, 0)
    controlHolder.Size = UDim2.new(0, 80, 1, 0)

    local function createControlBtn(text, color, pos, callback)
        local btn = Instance.new("TextButton")
        btn.Parent = controlHolder
        btn.BackgroundTransparency = 1
        btn.Position = pos
        btn.Size = UDim2.new(0.5, 0, 1, 0)
        btn.Font = Enum.Font.GothamBold
        btn.Text = text
        btn.TextColor3 = color
        btn.TextSize = 14
        btn.MouseButton1Click:Connect(callback)
        return btn
    end

    -- Open pill (when closed)
    local openPill = Instance.new("TextButton")
    openPill.Parent = screenGui
    openPill.BackgroundColor3 = self.Theme.Card
    openPill.Position = UDim2.new(0.5, -60, 0, -50)
    openPill.Size = UDim2.new(0, 120, 0, 30)
    openPill.Font = Enum.Font.GothamBold
    openPill.Text = "Open " .. windowName
    openPill.TextColor3 = accent
    openPill.TextSize = 12
    openPill.Visible = false

    local openStroke = Instance.new("UIStroke")
    openStroke.Parent = openPill
    openStroke.Color = accent
    openStroke.Thickness = 1
    openStroke.Transparency = 0.5

    local openCorner = Instance.new("UICorner")
    openCorner.CornerRadius = UDim.new(1, 0)
    openCorner.Parent = openPill

    local isMinimized = false

    -- Minimize: shrink/expand main frame
    createControlBtn("-", self.Theme.TextDim, UDim2.new(0, 0, 0, 0), function()
        isMinimized = not isMinimized

        if isMinimized then
            TweenService:Create(main, TweenInfo.new(0.25), {
                Size = UDim2.new(0, 650, 0, 40)
            }):Play()
            sidebar.Visible = false
        else
            TweenService:Create(main, TweenInfo.new(0.25), {
                Size = UDim2.new(0, 650, 0, 420)
            }):Play()
            task.delay(0.15, function()
                sidebar.Visible = true
            end)
        end
    end)

    -- Close: hide main, show reopen pill
    createControlBtn("X", Color3.fromRGB(255, 80, 80), UDim2.new(0.5, 0, 0, 0), function()
        main.Visible = false
        openPill.Visible = true
        TweenService:Create(openPill, TweenInfo.new(0.4, Enum.EasingStyle.Back), {
            Position = UDim2.new(0.5, -60, 0, 20)
        }):Play()
    end)

    openPill.MouseButton1Click:Connect(function()
        TweenService:Create(openPill, TweenInfo.new(0.25), {
            Position = UDim2.new(0.5, -60, 0, -50)
        }):Play()
        task.delay(0.18, function()
            openPill.Visible = false
            main.Visible = true
        end)
    end)

    MakeDraggable(topBar, main)

    -- Pages holder
    local pages = Instance.new("Frame")
    pages.Parent = main
    pages.BackgroundTransparency = 1
    pages.Position = UDim2.new(0, 70, 0, 50)
    pages.Size = UDim2.new(1, -80, 1, -60)

    -----------------------------------------------------------------
    -- HOME DASHBOARD
    -----------------------------------------------------------------
    local function createHome()
        local homeTab = Instance.new("Frame")
        homeTab.Name = "Home"
        homeTab.Parent = pages
        homeTab.BackgroundTransparency = 1
        homeTab.Size = UDim2.new(1, 0, 1, 0)
        homeTab.Visible = true

        -- User card
        local userCard = Instance.new("Frame")
        userCard.Parent = homeTab
        userCard.BackgroundColor3 = self.Theme.Card
        userCard.Size = UDim2.new(1, 0, 0, 90)
        Instance.new("UICorner", userCard).CornerRadius = UDim.new(0, 6)
        Instance.new("UIStroke", userCard).Color = self.Theme.Outline

        local pfp = Instance.new("ImageLabel")
        pfp.Parent = userCard
        pfp.BackgroundColor3 = self.Theme.Background
        pfp.Position = UDim2.new(0, 15, 0, 15)
        pfp.Size = UDim2.new(0, 60, 0, 60)
        Instance.new("UICorner", pfp).CornerRadius = UDim.new(1, 0)

        task.spawn(function()
            local ok, content = pcall(function()
                return Players:GetUserThumbnailAsync(
                    LocalPlayer.UserId,
                    Enum.ThumbnailType.HeadShot,
                    Enum.ThumbnailSize.Size100x100
                )
            end)
            if ok then
                pfp.Image = content
            end
        end)

        local welcome = Instance.new("TextLabel")
        welcome.Parent = userCard
        welcome.BackgroundTransparency = 1
        welcome.Position = UDim2.new(0, 90, 0, 20)
        welcome.Size = UDim2.new(0, 260, 0, 20)
        welcome.Font = Enum.Font.GothamBold
        welcome.Text = "Welcome back, " .. LocalPlayer.DisplayName
        welcome.TextColor3 = self.Theme.Text
        welcome.TextSize = 16
        welcome.TextXAlignment = Enum.TextXAlignment.Left

        local rank = Instance.new("TextLabel")
        rank.Parent = userCard
        rank.BackgroundTransparency = 1
        rank.Position = UDim2.new(0, 90, 0, 45)
        rank.Size = UDim2.new(0, 260, 0, 20)
        rank.Font = Enum.Font.Gotham
        rank.Text = "User | " .. ((identifyexecutor and identifyexecutor()) or "Unknown Executor")
        rank.TextColor3 = accent
        rank.TextSize = 12
        rank.TextXAlignment = Enum.TextXAlignment.Left

        -- Server stats
        local serverCard = Instance.new("Frame")
        serverCard.Parent = homeTab
        serverCard.BackgroundColor3 = self.Theme.Card
        serverCard.Position = UDim2.new(0, 0, 0, 100)
        serverCard.Size = UDim2.new(0.55, -5, 1, -100)
        Instance.new("UICorner", serverCard).CornerRadius = UDim.new(0, 6)
        Instance.new("UIStroke", serverCard).Color = self.Theme.Outline

        local sTitle = Instance.new("TextLabel")
        sTitle.Parent = serverCard
        sTitle.BackgroundTransparency = 1
        sTitle.Position = UDim2.new(0, 15, 0, 15)
        sTitle.Size = UDim2.new(1, 0, 0, 20)
        sTitle.Font = Enum.Font.GothamBold
        sTitle.Text = "Server Statistics"
        sTitle.TextColor3 = self.Theme.TextDim
        sTitle.TextSize = 12
        sTitle.TextXAlignment = Enum.TextXAlignment.Left

        local function makeStat(labelText, valueFunc, yPos)
            local label = Instance.new("TextLabel")
            label.Parent = serverCard
            label.BackgroundTransparency = 1
            label.Position = UDim2.new(0, 15, 0, yPos)
            label.Size = UDim2.new(1, -30, 0, 20)
            label.Font = Enum.Font.Gotham
            label.Text = labelText .. ": Loading..."
            label.TextColor3 = self.Theme.Text
            label.TextSize = 12
            label.TextXAlignment = Enum.TextXAlignment.Left

            task.spawn(function()
                while serverCard.Parent do
                    local ok, val = pcall(valueFunc)
                    if ok and val ~= nil then
                        label.Text = labelText .. ": " .. tostring(val)
                    end
                    task.wait(1)
                end
            end)
        end

        makeStat("Ping", function()
            local ok, ping = pcall(function()
                return LocalPlayer:GetNetworkPing()
            end)
            if not ok or not ping then return "N/A" end
            return tostring(math.floor(ping * 1000 + 0.5)) .. "ms"
        end, 50)

        makeStat("Players", function()
            return #Players:GetPlayers() .. "/" .. tostring(Players.MaxPlayers or "?")
        end, 80)

        makeStat("Time", function()
            return os.date("%H:%M")
        end, 110)

        makeStat("FPS", function()
            local dt = RunService.RenderStepped:Wait()
            return tostring(math.floor(1 / dt + 0.5))
        end, 140)

        -- Game info card
        local infoCard = Instance.new("Frame")
        infoCard.Parent = homeTab
        infoCard.BackgroundColor3 = self.Theme.Card
        infoCard.Position = UDim2.new(0.55, 5, 0, 100)
        infoCard.Size = UDim2.new(0.45, -5, 1, -100)
        Instance.new("UICorner", infoCard).CornerRadius = UDim.new(0, 6)
        Instance.new("UIStroke", infoCard).Color = self.Theme.Outline

        local iTitle = Instance.new("TextLabel")
        iTitle.Parent = infoCard
        iTitle.BackgroundTransparency = 1
        iTitle.Position = UDim2.new(0, 15, 0, 15)
        iTitle.Size = UDim2.new(1, 0, 0, 20)
        iTitle.Font = Enum.Font.GothamBold
        iTitle.Text = "Game Info"
        iTitle.TextColor3 = self.Theme.TextDim
        iTitle.TextSize = 12
        iTitle.TextXAlignment = Enum.TextXAlignment.Left

        local gameName = Instance.new("TextLabel")
        gameName.Parent = infoCard
        gameName.BackgroundTransparency = 1
        gameName.Position = UDim2.new(0, 15, 0, 45)
        gameName.Size = UDim2.new(1, -30, 0, 40)
        gameName.Font = Enum.Font.GothamBold
        gameName.TextColor3 = accent
        gameName.TextSize = 14
        gameName.TextWrapped = true
        gameName.TextXAlignment = Enum.TextXAlignment.Left
        gameName.TextYAlignment = Enum.TextYAlignment.Top

        task.spawn(function()
            local ok, info = pcall(function()
                return MarketplaceService:GetProductInfo(game.PlaceId)
            end)
            if ok and info and info.Name then
                gameName.Text = info.Name
            else
                gameName.Text = "Unknown Game"
            end
        end)

        return homeTab
    end

    local homeFrame = createHome()

    -----------------------------------------------------------------
    -- TABS
    -----------------------------------------------------------------
    local Tabs = {}

    local function resetTabIcons()
        for _, v in ipairs(tabContainer:GetChildren()) do
            if v:IsA("TextButton") and v:FindFirstChild("Icon") then
                v.Icon.ImageColor3 = Library.Theme.TextDim
            end
        end
    end

    -- Home button
    local homeBtn = Instance.new("TextButton")
    homeBtn.Parent = tabContainer
    homeBtn.BackgroundTransparency = 1
    homeBtn.Size = UDim2.new(0, 40, 0, 40)
    homeBtn.Text = ""

    local homeIcon = Instance.new("ImageLabel")
    homeIcon.Name = "Icon"
    homeIcon.Parent = homeBtn
    homeIcon.BackgroundTransparency = 1
    homeIcon.Position = UDim2.new(0, 8, 0, 8)
    homeIcon.Size = UDim2.new(0, 24, 0, 24)
    homeIcon.Image = "rbxassetid://3926305904"
    homeIcon.ImageColor3 = accent

    homeBtn.MouseButton1Click:Connect(function()
        for _, v in ipairs(pages:GetChildren()) do
            if v:IsA("GuiObject") then
                v.Visible = false
            end
        end

        homeFrame.Visible = true
        resetTabIcons()
        homeIcon.ImageColor3 = accent
    end)

    -----------------------------------------------------------------
    -- PUBLIC: CreateTab
    -----------------------------------------------------------------
    function Tabs:CreateTab(iconId)
        local page = Instance.new("ScrollingFrame")
        page.Parent = pages
        page.BackgroundTransparency = 1
        page.Size = UDim2.new(1, 0, 1, 0)
        page.Visible = false
        page.ScrollBarThickness = 2
        page.CanvasSize = UDim2.new(0, 0, 0, 0)

        local pageLayout = Instance.new("UIListLayout")
        pageLayout.Parent = page
        pageLayout.SortOrder = Enum.SortOrder.LayoutOrder
        pageLayout.Padding = UDim.new(0, 8)

        pageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            page.CanvasSize = UDim2.new(0, 0, 0, pageLayout.AbsoluteContentSize.Y + 20)
        end)

        local tabBtn = Instance.new("TextButton")
        tabBtn.Parent = tabContainer
        tabBtn.BackgroundTransparency = 1
        tabBtn.Size = UDim2.new(0, 40, 0, 40)
        tabBtn.Text = ""

        local tabIcon = Instance.new("ImageLabel")
        tabIcon.Name = "Icon"
        tabIcon.Parent = tabBtn
        tabIcon.BackgroundTransparency = 1
        tabIcon.Position = UDim2.new(0, 8, 0, 8)
        tabIcon.Size = UDim2.new(0, 24, 0, 24)
        tabIcon.Image = iconId
        tabIcon.ImageColor3 = Library.Theme.TextDim

        tabBtn.MouseButton1Click:Connect(function()
            for _, v in ipairs(pages:GetChildren()) do
                if v:IsA("GuiObject") then
                    v.Visible = false
                end
            end

            homeIcon.ImageColor3 = Library.Theme.TextDim
            resetTabIcons()

            page.Visible = true
            tabIcon.ImageColor3 = accent
        end)

        local Elements = {}

        function Elements:CreateSection(title)
            local sec = Instance.new("TextLabel")
            sec.Parent = page
            sec.BackgroundTransparency = 1
            sec.Size = UDim2.new(1, 0, 0, 25)
            sec.Font = Enum.Font.GothamBold
            sec.Text = "  " .. title
            sec.TextColor3 = Library.Theme.TextDim
            sec.TextSize = 11
            sec.TextXAlignment = Enum.TextXAlignment.Left
        end

        function Elements:AddToggle(name, flag, callback)
            if Library.Flags[flag] == nil then
                Library.Flags[flag] = false
            end

            local frame = Instance.new("Frame")
            frame.Parent = page
            frame.BackgroundColor3 = Library.Theme.Card
            frame.Size = UDim2.new(1, -5, 0, 38)
            Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 6)

            local label = Instance.new("TextLabel")
            label.Parent = frame
            label.BackgroundTransparency = 1
            label.Position = UDim2.new(0, 10, 0, 0)
            label.Size = UDim2.new(0.7, 0, 1, 0)
            label.Font = Enum.Font.GothamSemibold
            label.Text = name
            label.TextColor3 = Library.Theme.Text
            label.TextSize = 13
            label.TextXAlignment = Enum.TextXAlignment.Left

            local btn = Instance.new("TextButton")
            btn.Parent = frame
            btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            btn.Position = UDim2.new(1, -45, 0.5, -10)
            btn.Size = UDim2.new(0, 36, 0, 20)
            btn.Text = ""
            btn.AutoButtonColor = false
            Instance.new("UICorner", btn).CornerRadius = UDim.new(1, 0)

            local circle = Instance.new("Frame")
            circle.Parent = btn
            circle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
            circle.Position = UDim2.new(0, 2, 0.5, -8)
            circle.Size = UDim2.new(0, 16, 0, 16)
            Instance.new("UICorner", circle).CornerRadius = UDim.new(1, 0)

            local function applyState(state)
                local pos = state and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
                local color = state and accent or Color3.fromRGB(40, 40, 40)

                TweenService:Create(circle, TweenInfo.new(0.1), {Position = pos}):Play()
                TweenService:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = color}):Play()

                if callback then
                    task.spawn(callback, state)
                end
            end

            local function toggle()
                Library.Flags[flag] = not Library.Flags[flag]
                applyState(Library.Flags[flag])
            end

            btn.MouseButton1Click:Connect(toggle)

            -- init from flag
            applyState(Library.Flags[flag])

            function frame:Set(val)
                Library.Flags[flag] = not not val
                applyState(Library.Flags[flag])
            end

            return frame
        end

        function Elements:AddButton(name, callback)
            local frame = Instance.new("Frame")
            frame.Parent = page
            frame.BackgroundColor3 = Library.Theme.Card
            frame.Size = UDim2.new(1, -5, 0, 38)
            Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 6)

            local btn = Instance.new("TextButton")
            btn.Parent = frame
            btn.BackgroundTransparency = 1
            btn.Size = UDim2.new(1, 0, 1, 0)
            btn.Font = Enum.Font.GothamSemibold
            btn.Text = name
            btn.TextColor3 = Library.Theme.Text
            btn.TextSize = 13

            btn.MouseButton1Click:Connect(function()
                TweenService:Create(frame, TweenInfo.new(0.08), {
                    BackgroundColor3 = accent
                }):Play()
                task.wait(0.1)
                TweenService:Create(frame, TweenInfo.new(0.1), {
                    BackgroundColor3 = Library.Theme.Card
                }):Play()
                if callback then
                    task.spawn(callback)
                end
            end)
        end

        function Elements:AddConfigSystem()
            Elements:CreateSection("Configuration")

            local nameFrame = Instance.new("Frame")
            nameFrame.Parent = page
            nameFrame.BackgroundColor3 = Library.Theme.Card
            nameFrame.Size = UDim2.new(1, -5, 0, 38)
            Instance.new("UICorner", nameFrame).CornerRadius = UDim.New(0, 6)

            local box = Instance.new("TextBox")
            box.Parent = nameFrame
            box.BackgroundTransparency = 1
            box.Position = UDim2.new(0, 10, 0, 0)
            box.Size = UDim2.new(1, -20, 1, 0)
            box.Font = Enum.Font.Gotham
            box.PlaceholderText = "Config name..."
            box.Text = ""
            box.TextColor3 = Library.Theme.Text
            box.TextSize = 13

            Elements:AddButton("Save Config", function()
                if box.Text ~= "" then
                    Library:SaveConfig(box.Text)
                end
            end)

            Elements:AddButton("Load Config", function()
                if box.Text ~= "" then
                    local data = Library:LoadConfig(box.Text)
                    if data then
                        print("[Eclipse] Loaded config table:", data)
                        -- manually map data back into UI if you want full restore
                    end
                end
            end)
        end

        return Elements
    end

    return Tabs
end

return Library
